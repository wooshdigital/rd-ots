{
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "validate_employee",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "validate_employee"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "create_additional_salary",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "create_additional_salary"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "check_system_enabled",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "check_system_enabled"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "get_employee_details",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get_employee_details"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "check_duplicate_salary",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "check_duplicate_salary"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "get_approver",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get_approver"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "get_hr_staff",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get_hr_staff"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.operation }}",
                    "rightValue": "get_approvers_by_designation",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get_approvers_by_designation"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "7cd7a3f4-4db7-4449-b2da-7efea8824a3b",
      "name": "Route Operation",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -1936,
        4480
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "docType": "Employee",
        "limit": 1,
        "options": {
          "fields": [
            "employee_name",
            "employee",
            "reports_to",
            "designation"
          ],
          "filters": {
            "customProperty": [
              {
                "field": "company_email",
                "value": "={{ $json.body.email }}"
              },
              {
                "field": "status",
                "value": "Active"
              }
            ]
          }
        }
      },
      "id": "a81d59ca-13d4-4277-b127-ce10e6fefaa6",
      "name": "Find Employee",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        3824
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "url": "https://roochedigital.frappe.cloud/api/resource/Company%20Program?fields=[\"name\",\"program_manager\"]&filters=[[\"name\", \"=\", \"Overtime System\"], [\"status\", \"=\", \"Active\"]]",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "erpNextApi",
        "options": {}
      },
      "id": "19b2bfc7-b5e1-4fbd-b14f-a23f9af90de7",
      "name": "Check System Enabled",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1712,
        4208
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://roochedigital.frappe.cloud/api/resource/Additional%20Salary?fields=[\"employee\"]&filters=[[\"employee\", \"=\", \"{{ $json.body.employee_id }}\"], [\"salary_component\", \"=\", \"{{ $json.body.salary_component }}\"], [\"docstatus\", \"=\", \"1\"], [\"payroll_date\", \"=\", \"{{ $json.body.payroll_date }}\"]]",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "erpNextApi",
        "options": {}
      },
      "id": "c16d4896-e3f8-44bd-a258-4b8da2acf4ef",
      "name": "Check Duplicate Salary",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1712,
        4592
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "docType": "Employee",
        "limit": 1,
        "options": {
          "fields": [
            "employee_name",
            "reports_to"
          ],
          "filters": {
            "customProperty": [
              {
                "field": "employee",
                "value": "={{ $json.body.employee_id }}"
              }
            ]
          }
        }
      },
      "id": "121cc3a7-180f-43c3-bfca-c7bef89bb94e",
      "name": "Get Approver",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        4784
      ],
      "alwaysOutputData": true,
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "docType": "Employee",
        "returnAll": true,
        "options": {
          "fields": [
            "company_email",
            "employee_name",
            "employee",
            "designation"
          ],
          "filters": {
            "customProperty": [
              {
                "field": "designation",
                "value": "Human Resources"
              },
              {
                "field": "status",
                "value": "Active"
              }
            ]
          }
        }
      },
      "id": "4547f1e4-d28d-4093-ab9c-045ccbdb8756",
      "name": "Get HR Staff",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        4976
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "docType": "Employee",
        "returnAll": true,
        "options": {
          "fields": [
            "company_email",
            "employee_name",
            "employee",
            "designation"
          ],
          "filters": {
            "customProperty": [
              {
                "field": "designation",
                "value": "={{ $json.body.designation }}"
              },
              {
                "field": "status",
                "value": "Active"
              }
            ]
          }
        }
      },
      "id": "616ac4f3-2c9d-4d9d-a0f8-6527dce73ccf",
      "name": "Get Approvers by Designation",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        5168
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { \"success\": false, \"error\": \"Invalid operation\" } }}",
        "options": {
          "responseCode": 400
        }
      },
      "id": "65ee940d-36a6-4ceb-a358-f16ae2ac4d19",
      "name": "Respond Error",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1712,
        5360
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "erpnext-service",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a28fe40d-11c7-431b-8b1a-1829ded0999a",
      "name": "Webhook Trigger1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -2160,
        4592
      ],
      "webhookId": "erpnext-service-webhook-id"
    },
    {
      "parameters": {
        "operation": "get",
        "docType": "Employee",
        "documentName": "={{ $json.body.employee_id }}"
      },
      "id": "3153d5e3-9162-4443-9072-9006b4999dc9",
      "name": "Get Employee Details",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        4400
      ],
      "credentials": {
        "erpNextApi": {
          "id": "8gEOv9ig27O1vHWU",
          "name": "ERPNext account 2"
        }
      }
    },
    {
      "parameters": {
        "docType": "Additional%20Salary",
        "properties": {
          "customProperty": [
            {
              "field": "employee",
              "value": "={{ $json.body.employee_id }}"
            },
            {
              "field": "payroll_date",
              "value": "={{ $json.body.payroll_date }}"
            },
            {
              "field": "salary_component",
              "value": "={{ $json.body.salary_component }}"
            },
            {
              "field": "custom_number_of_hours",
              "value": "={{ $json.body.total_hours }}"
            },
            {
              "field": "amount",
              "value": "={{ parseFloat(0) }}"
            },
            {
              "field": "docstatus",
              "value": "1"
            },
            {
              "field": "custom_notes",
              "value": "={{ $json.body.notes }}"
            }
          ]
        }
      },
      "id": "14e33b4a-1510-4578-b500-2d7bce818e60",
      "name": "Create Additional Salary",
      "type": "n8n-nodes-base.erpNext",
      "typeVersion": 1,
      "position": [
        -1712,
        4016
      ],
      "credentials": {
        "erpNextApi": {
          "id": "36CTQ7mtkjLbrhVF",
          "name": "ERPNext account"
        }
      },
      "notes": "Updated to use total_hours (decimal) instead of separate hours/minutes"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "e1828d4f-fb7e-4fc5-956b-3c2ce7ef8110",
      "name": "Respond Error/Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1488,
        4496
      ]
    }
  ],
  "connections": {
    "Route Operation": {
      "main": [
        [
          {
            "node": "Find Employee",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Additional Salary",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check System Enabled",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Employee Details",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Duplicate Salary",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Approver",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get HR Staff",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Approvers by Designation",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find Employee": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check System Enabled": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate Salary": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Approver": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get HR Staff": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Approvers by Designation": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Trigger1": {
      "main": [
        [
          {
            "node": "Route Operation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Employee Details": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Additional Salary": {
      "main": [
        [
          {
            "node": "Respond Error/Success",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    }
  },
  "pinData": {
    "Webhook Trigger1": [
      {
        "headers": {
          "host": "n8n.roochedigital.com",
          "user-agent": "axios/1.13.2",
          "content-length": "306",
          "accept": "application/json, text/plain, */*",
          "accept-encoding": "gzip, compress, deflate, br",
          "content-type": "application/json",
          "via": "1.1 Caddy",
          "x-forwarded-for": "159.65.11.83",
          "x-forwarded-host": "n8n.roochedigital.com",
          "x-forwarded-proto": "https"
        },
        "params": {},
        "query": {},
        "body": {
          "operation": "create_additional_salary",
          "employee_id": "HR-EMP-00103",
          "payroll_date": "2025-11-17",
          "salary_component": "Overtime",
          "total_hours": 1.5,
          "notes": "Reason: Just a test but please approve to see the outcome\nProjects: internal-primdream\nApproved by: dionela@rooche.digital\nRequested on: 11/17/2025"
        },
        "webhookUrl": "https://n8n.roochedigital.com/webhook/erpnext-service",
        "executionMode": "production"
      }
    ]
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "33325513eb860da8efda6c55ed4c66273261e6cd3bc946809f06fcd754555539"
  }
}